\documentclass{patmorin}
\listfiles
\usepackage[utf8]{inputenc}
\usepackage{microtype}
\usepackage{amsthm,amsmath,graphicx}
\usepackage{pat}
\usepackage[letterpaper]{hyperref}
\usepackage[table,dvipsnames]{xcolor}
\definecolor{linkblue}{named}{Blue}
\hypersetup{colorlinks=true, linkcolor=linkblue,  anchorcolor=linkblue,
citecolor=linkblue, filecolor=linkblue, menucolor=linkblue,
urlcolor=linkblue} 
\setlength{\parskip}{1ex}
\usepackage{wasysym}

\title{\MakeUppercase{Anagram-Free Chromatic Number is not Pathwidth Bounded}}

\author{Paz Carmi, Vida Dujmović, and Pat Morin}%

%\usepackage[mathlines]{lineno}
%\linenumbers
%\setlength{\linenumbersep}{2.5cm}
%\rightlinenumbers
%\linenumbers
%\newcommand*\patchAmsMathEnvironmentForLineno[1]{%
%  \expandafter\let\csname old#1\expandafter\endcsname\csname #1\endcsname
%  \expandafter\let\csname oldend#1\expandafter\endcsname\csname end#1\endcsname
%  \renewenvironment{#1}%
%     {\linenomath\csname old#1\endcsname}%
%     {\csname oldend#1\endcsname\endlinenomath}}% 
%\newcommand*\patchBothAmsMathEnvironmentsForLineno[1]{%
%  \patchAmsMathEnvironmentForLineno{#1}%
%  \patchAmsMathEnvironmentForLineno{#1*}}%
%\AtBeginDocument{%
%\patchBothAmsMathEnvironmentsForLineno{equation}%
%\patchBothAmsMathEnvironmentsForLineno{align}%
%\patchBothAmsMathEnvironmentsForLineno{flalign}%
%\patchBothAmsMathEnvironmentsForLineno{alignat}%
%\patchBothAmsMathEnvironmentsForLineno{gather}%
%\patchBothAmsMathEnvironmentsForLineno{multline}%
%}


\newcommand{\question}[1]{\textbf{\color{red}Question:}~#1}

\DeclareMathOperator{\ob}{obs}
\DeclareMathOperator{\planeobs}{plane-obs}

\newcommand{\eps}{\epsilon}

%\pagenumbering{roman}
\begin{document}
%\begin{titlepage}
\maketitle
%
\begin{abstract}
  The anagram-free chromatic number is a new graph parameter introduced
  independently Kamčev, Łuczak, and Sudakov \cite{kamcev.luczak.ea:anagram-free}
  and Wilson and Wood \cite{wilson.wood:anagram-free}.  In this note, we show
  that there are graphs of pathwidth 3 with arbitrarily large anagram-free
  chromatic number.
\end{abstract}
%\end{titlepage}
%
%\tableofcontents
%
%\newpage


\section{Introduction}
\pagenumbering{arabic}

A string $s=s_1,\ldots,s_{2k}$ is called an \emph{anagram} if $s_1,\ldots,s_k$ is a permutation of $s_{k+1},\ldots,s_{2k}$.
For a graph $G$, a $c$-colouring $\varphi:V(G)\to\{1,\ldots,c\}$ is
\emph{anagram-free} if, for every path $v_1,v_2,\ldots,v_{2_k}$ in
$G$, the string $\varphi(v_1),\ldots,\varphi(v_{2k})$ is not an anagram.  The
\emph{anagram-free chromatic number} of $G$, denoted $\pi_\alpha(G)$, is
the smallest value of $c$ for which $G$ has an anagram-free $c$-colouring.

Answering a long-standing question of Erd\H{o}s and Brown, Ker\"anen
showed that the path $P_n$ on $n$ vertices has an anagram-free
4-colouring.  A straightforward divide-and-conquer algorithm applied
to any $n$-vertex graph of treewidth $k$ yields an anagram-free
$O(k\log n)$-colouring.  The same divide-and-conquer algoritm,
applied to graphs that exclude a fixed minor gives an anagram
free $O(\sqrt{n})$-colouring.  An interesting variant of this is
given by Wilson and Wood \cite{wilson.wood:anagram-free} who give a
divide-and-conquer method of colouring trees of pathwidth $k$ that uses
only $4k+1$ colours.  Wilson and Wood \cite{wilson.wood:anagram-free2}
show that any graph can be subdivided (by splitting edges into paths)
so that the resulting subdivision has an anagram-free 8-colouring.
On the negative side, Kamčev, Łuczak,
and Sudakov \cite{kamcev.luczak.ea:anagram-free} and Wilson and Wood
\cite{wilson.wood:anagram-free} have shown that there are trees---even binary trees---with arbitrarily large anagram-free chromatic number.
These results are summarized in \tabref{results}.

\begin{table}
  \begin{center}
    \begin{tabular}{lll}
      \textbf{Graph class} & \textbf{Bounds} & \textbf{Reference} \\ \hline
       Paths & $\pi_\alpha(G)= 4$ & \cite{keranen:abelian}  \\
       Graphs of treewidth $k$ & $\pi_\alpha(G)\in O(k\log n)$ & folklore  \\
       Graphs with an excluded minor of size $h$ & $\pi_\alpha(G)\in O(h^{3/2}n^{1/2})$ 
              & \cite{kamcev.luczak.ea:anagram-free} \\
       Trees & $\pi_\alpha(G)\in\Omega(\log n/\log\log n)$ 
              & \cite{wilson.wood:anagram-free} \\
       Trees of pathwidth $k$ & $k\le \pi_\alpha(G)\le 4k+1$ 
              & \cite{wilson.wood:anagram-free} \\
       Trees of radius $r$ & $r\le \pi_\alpha(G)\le r+1$ 
              & \cite{wilson.wood:anagram-free} \\
       Planar graphs of maximum degree 3 & $\pi_\alpha(G)\in\Omega(\log n)$ 
         & \cite{kamcev.luczak.ea:anagram-free,wilson.wood:anagram-free} \\
       Binary trees & $\pi_\alpha(G)\in\Omega(\sqrt{\log n/\log\log n})$ 
              & \cite{kamcev.luczak.ea:anagram-free} \\ 
       $4$-regular graphs & $\pi_\alpha(G)\in \Omega(\sqrt{n}{\log n})$ & \cite{kamcev.luczak.ea:anagram-free} \\
       $d$-regular graphs & $\pi_\alpha(G)\in \Omega(n)$ & \cite{kamcev.luczak.ea:anagram-free} \\
       Planar graphs of pathwidth 3 & $\pi_\alpha(G) \in \Omega(\sqrt{\log n})$
         & \thmref{main} \\
       Subdivisions of graphs & $\pi_\alpha(G) \le 8$ 
         & \cite{wilson.wood:anagram-free2}
    \end{tabular}
  \end{center}
  \caption{Bounds on anagram-free chromatic number.  Upper bounds apply to all graphs in the class. Lower bounds apply to some graphs in the class.}
  \tablabel{results}
\end{table}

An obvious question that arises from these results is the question
of whether anagram-free chromatic number is pathwidth-bounded; can
$\pi_\alpha(G)$ be upper bounded by some function of the pathwidth
of $G$?  Wilson and Wood showed this is is true if $G$ is a \emph{tree}.  
This quest

The purpose of this note is to show that the result of Wilson and
Wood can not be strengthened to graphs of pathwidth $k$.

\begin{thm}\thmlabel{main}
  For every $n$, there exists a planar graph of pathwidth 3 whose anagram-free
  chromatic number is $\Omega(\sqrt{\log n})$. 
\end{thm}



\section{Proof of \thmref{main}}

Let $s\in\Sigma^*$ be a string over some alphabet $\Sigma$.  For each
$i\in\Sigma$, $n_i(s)$ denotes the number of occurences of $i$
in $s$.  We say that $s$ is \emph{even} if $n_i(s)$ is even for each
$i\in\Sigma$. We say that $n_i(s)$ is \emph{stronly odd} if $s$ has no
even substring of length greater than 0.

\begin{lem}
  If $s\in\Sigma^n$ is strongly odd, then $|\Sigma|\ge\log_2(n+1)$.
\end{lem}

\begin{proof}
  For any string $q\in\Sigma^*$, consider the \emph{parity vector}
  $P(q)=\langle n_i(q)\bmod 2: i\in\Sigma \rangle$ and observe that
  $q$ is even if and only if $P(q)=\langle 0,\ldots,0\rangle$.  Let
  $s=s_1,\ldots,s_n$ be a strongly odd string and consider the sequence
  of parity vectors: $P_1,\ldots,P_n$, where $P_i=P(s_1,\ldots,s_i)$.
  Observe that every vector in this sequence is unique since,
  if there were a $P_i = P_j$ with $i<j$, then this implies that
  $P(s_{i+1},\ldots,s_j)=\langle 0,ldots,0\rangle$, contradicting the
  assumption that $s$ is strongly odd.
  Now each of $P_1,\ldots,P_n$ is a binary string of length $|\Sigma|$, they
  are all unique and none of them is equal to $\langle 0,\ldots,0\rangle$. Therefore $|\Sigma|\ge \log_2(n+1)$.
\end{proof}

\begin{proof}[Proof of \thmref{main}]
Let $G$ be the graph with vertex set
$V(G)=\{x_1,\ldots,x_{n},y_1,\ldots,y_{n}\}$ and with edge set
\[
  E(G) = \{x_iy_i : i\in\{0,\ldots,n-1\}\} \cup \bigcup_{i=0}^{n-2} \{x_iy_{i+1},x_{i+1}y_i\} \enspace .
\]
We call the pairs $x_i$ and $y_i$ \emph{twins}.
The graph $G$ has pathwidth 3 as can be seen from the path decomposition $B_1,\ldots,B_{n-1}$ where $B_i=\{v_i,w_i,v_{i+1},w_{i+1}\}$.
See \figref{graph}. Although not immediately obvious from \figref{graph}, $G$ is also planar---each of the diagonal edges $x_iy_{i+1}$ can be redrawn as a curve outside the cycle $x_1,\ldots,x_n,y_n,\ldots,y_1$ that does not cross any other edges.

\begin{figure}
  \begin{center}
    \includegraphics[width=\textwidth]{figs/g}
  \end{center}
  \caption{The graph $G$ in the proof of \thmref{main}.}
  \figlabel{graph}
\end{figure}

Now, consider some colouring $\varphi:V(G)\to\{1,\ldots,\alpha\}$ of $G$
By \lemref{balanced}, $s$ contains a balanced substring $t$ if $n$
is sufficiently large.  Refer to \figref{b}. Since $t$
is balanced, a na\"ive greedy algorithm allows us to construct a bipartite
 graph $B$ whose edges join
elements of the first half of $t$ to equal elements in the second half
and having the following properties: $B$ has minimum degree 1, maximum
degree 2 and contains no path of length greater than 2.  Thus, the
connected components of $B$ are paths of length 1 and paths of length 2.

\begin{figure}
  \begin{center}
    \includegraphics[width=\textwidth]{figs/graph}
  \end{center}
  \caption{A balanced substring $t$ of $s$ produces a path in $G$ whose
    colour sequence is an anagram.}
  \figlabel{b}
\end{figure}


We will use $B$ to construct a path $P$ in $G$ whose colouring is an
anagram.  For each length-1 component $s_is_j$ of $B$, the path $P$
will include $x_i$, and the vertex $u\in\{x_j,y_j\}$ with $\varphi(z)=\varphi(x_i)$. For each length-2 path
$s_is_js_k$ the path $P$ include $x_i$, $x_j$, $y_j$, and the 
vertex $u\in\{x_k,y_k\}$ such that $\varphi(u)\neq \varphi(x_i)$.
The ordering of vertices along the path $P$ is by increasing order
of index, with ties (among twins) broken arbitrarily.
The fact that $B$ has minimum degree 1 ensures that $P=u_1,\ldots,u_m$
is indeed a path in $G$.  The choice of vertices in $P$ ensures that
$\varphi(u_1),\ldots,\varphi(u_m)$ is an anagram since length-1 components
of $B$ create an vertex in the first half that cancels a vertex in the second
half and length-2 components create twins in one half that cancel two
vertices in the other half.
\end{proof}

\begin{proof}[Proof of \lemref{balanced}]
  Call a string a \emph{$c$-string} if it is over an alphabet of size $c$
  and call a string \emph{good} if it contains no balanced substring.
  For each $c\in\N$, let $h_c$ denote the minimum integer for which
  there is no good $c$-string of length $2^{h_c}$.  Thus, our goal is
  to show that $h_c$ is finite for each $c\in\N$.
  Suppose this is not true so that there exists some minimum value
  $c$ for which $h_c$ is infinite.  Choosing the minimum such value of 
  $c$ ensures that $h_{c-1}$ is finite and that any good (sub)string of
  length at least $r:=2^{h_{c-1}}$ uses an alphabet of size at least $c$.

  Let $s$ be a good string over the alphabet $\Sigma=\{1,\ldots,c\}$ and having
  length $r2^{h}$, for some value $h$ to specified shortly.   Consider
  the complete binary tree $T$ of height $h$ whose leaves, in order,
  are the length-1 substrings of $s$ and for which each internal node is
  the substring obtained by concatenating the node's left and right child.
  See \figref{binary-tree}.

  \begin{figure}
    \begin{center}
       \includegraphics[width=\textwidth]{figs/binary-tree-1}
    \end{center}
    \caption{Building a binary tree $T$ over the string $s$.}
    \figlabel{binary-tree}
  \end{figure}

  For each node $v$ of $T$, let $h(v)$ denote the height of $v$'s subtree
  and $s(v)=2^{h(v)}$ denote the length of the string $v$. For each
  $i\in\Sigma$, let $w_i(v):=n_i(v)/s(v)$.  Note that $0\le w_i(v)\le
  1/2$ and that $\sum_{i\in\Sigma} w_i(v)=1$.  Furthermore, if $v$
  has two children $x$ and $y$, then $w_i(v) = (w_i(x)+w_i(y))/2$.
  The assumption that $s$ has no balanced substring implies $v$ is
  $i$-unbalanced, for some $i\in\Sigma$.  Assign each internal node
  $v$ of $T$ the \emph{label} $\ell(v):=\min\{i\in\Sigma: \mbox{$v$
  is $i$-unbalanced}\}$.

  \begin{figure}
    \begin{center}
       \includegraphics[width=\textwidth]{figs/binary-tree-3} 
    \end{center}
    \caption{The tree $T$ with the vector $(w_1(v),\ldots,w_5(v))$ for each
     internal node $v$.  The unbalanced index that defines $\ell(v)$ is highlited for each node.}
    \figlabel{binary-tree-2}
  \end{figure}

  For each $i\in\Sigma$, let $S_i=\{v\in V(T): \ell(v)=i\}$ and observe that 
  \[
      \sum_{v\in V(T)}s(v)=\sum_{i\in\Sigma} \sum_{v\in S_i} s(v) = (h+\log_2 r)r2^{h}
  \]
  and therefore, there exists some $i^*\in\Sigma$ such that $\sum_{v\in
  S_{i^*}}s(v)\ge (h+\log_2 r)r2^h/c$.  Let $X=S_{i^*}$ and $w=w_{i^*}$.
  From this point on the proof makes no further reference to the original
  string $s$.  It is helpful to think of $T$ as having being ordered
  so that, for each internal node $v$ with left and right children $x$
  and $y$, respectively, $w(x)\ge w(y)$.  From this point on we use
  the shorthands (for any $R\subseteq V(T)$) $s(R):=\sum_{v\in R}s(v)$
  and $w(R):=\sum_{v\in R}s(v)w(v)/s(R)$.

  Summarizing, we have a complete binary tree $T$ of height $h+\log_2 r$ and
  a subset $X\subseteq V(T)$ with the following properties: 
  \begin{enumerate}
    \item For each $v\in V(T)$, $w(v) \le 1/2$.
    \item For each $v\in V(T)$ with $s(v) \ge r$, $w(v)\ge 1/r$.
    \item For each internal node $v\in V(T)$ with children $x$ and $y$,
       $w(v) = (w(x)+w(y))/2$.
    \item $w(X) \ge (h+\log_2 r)r2^{h}/c$.
     \item For each internal node $v\in V(T)\cap X$ with children $x$ and $y$,
       $w(x) > 2w(y)$.
  \end{enumerate}
  Now, for each $i\in\{1,\ldots,h\}$, let $X_i\subset X$ denote the
  set of nodes $v\in X$ for which the path from the root of $T$ to $v$
  contains exactly $i$ nodes in $X$ (including $v$).  Observe that 
  \[  r2^h \ge s(X_1) \ge s(X_2) \ge \cdots\ge s(X_{h+\log_2 r}) \enspace . \]

  We will show that, there exists a constant $t$ such that, 
  for each $i\in\{1,\ldots,h-t\}$,  
  \begin{equation}
     s(X_{i+t}) \le (1-(1/2)^{t+1}) s(X_i) \enspace . \eqlabel{t}
  \end{equation}
  In this way, 
  \begin{align*}
     (h+\log_2 r)r2^{h}/c 
        \le s(X) & = \sum_{i=1}^{h+\log_2 r} s(X_i) \\
           &\le (\log_2 r)r2^{h}+\sum_{i=1}^{h} s(X_i) \\
           &\le (\log_2 r)r2^{h}+\sum_{i=1}^{h} s(X_{\floor{i/t}+1}) \\
           &\le (\log_2 r)r2^{h}+t\sum_{i=0}^{\floor{h/t}} s(X_{it+1}) \\
           &\le (\log_2 r)r2^{h}+t\sum_{i=0}^{\infty} (1-(1/2)^{t+1})^i s(X_1) \\
           &\le (\log_2 r)r2^{h}+tr2^{h}\sum_{i=0}^{\infty} (1-(1/2)^{t+1})^i  \\
           & = (\log_2 r+t2^{t+1})r2^{h} 
  \end{align*}
  which is a contradiction for sufficiently large $h$; in particular, for 
  \[    
        h \ge (c-1)\log_2 r+ ct2^{t+1} \enspace . 
  \]

  It remains to establish \eqref{t}, which we do now.  For each node
  $v\in X$, let $R(v)$ denote the unique child of $v$ such that $w(R(v))
  < 2w(v)/3$, i.e., the right child of $v$. (The existence of $R(v)$ follows from Properties~3 and
  5, above).  For a subset $A\subset X$, let $R(A)=\{R(x):x\in A\}$.
  Define $A_0\subseteq X_i$ and, for each $j\ge 1$, define $A_j$
  to be the subset of $X_{i+j}$ that are descendants of some node in
  $R(A_{i-1})$.  See \figref{bigtree}. Observe that $s(A_i) \le s(R(A_{i-1})) = s(A_{i-1})/2$,
  so 
   \begin{align*}
      s(X_{i+t}) 
         &\le (1/2)s(A_0) + (1/2)s(A_1) + \cdots + (1/2)s(A_{t-1}) + s(A_t) \\
         &\le (1/2)s(A_0) + (1/4)s(A_0) + \cdots + (1/2)^t s(A_{0}) + s(A_t) \\
         &  = (1-(1/2)^t)s(A_0) + s(A_t) \enspace .
   \end{align*}
  So all that remains to establish \eqref{t} is to prove that 
  $s(A_t)\le (1/2)^{t+1}s(A_0)$.

  \begin{figure}
    \begin{center}
       \includegraphics[width=\textwidth]{figs/bigtree}
    \end{center}
    \caption{The partitioning of $X$ into $X_1,X_2,\ldots,X_h$. Shaded
    nodes are in $X$ and all nodes in $X_i$ are shaded with the same
    colour.   Starting with $A_0=X_1$, the elements of $A_0,\ldots,A_h$
    are highlighted.  The elements of $R(A_0),\ldots,R(A_h)$ are also highlighted.}
    \figlabel{bigtree}
  \end{figure}

  Now, the key inequality is 
  \begin{equation}
      w(A_i) \le w(R(A_{i-1}))\cdot\frac{s(R(A_{i-1}))}{s(A_i)}
  \end{equation}
  which implies
  \begin{equation}
       w(A_i) \le (2/3)w(A_{i-1})\cdot\frac{s(A_{i-1})}{2s(A_i)}
             = (1/3)w(A_{i-1})\cdot\frac{s(A_{i-1})}{s(A_i)}
             \eqlabel{strings}
  \end{equation}

  Beginning at $A_0$ and repeatedly applying \eqref{strings}, we obtain:
  \[
      w(A_t) \le (1/3)^t w(A_0)\cdot\frac{s(A_0)}{s(A_t)} 
             \le (1/2)(1/3)^t \cdot\frac{s(A_0)}{s(A_t)} \enspace .
  \]
  On the other hand, $w(A_t)\ge 1/r$, so  
  \[ 
      1/r \le (1/2)(1/3)^t\cdot\frac{s(A_0)}{s(A_t)} \enspace .
  \]
  and rearranging terms yields
  \[
     s(A_t) \le (1/2)(1/3)^t r s(A_0) \le (1/2)^{t+1}s(A_0)
  \]
  for $t = \ceil{\log_{3/2} r}$.
\end{proof}

\subsection{Remarks}

Our proofs of \lemref{balanced} and \thmref{main} give very weak lower
bounds on $c$ and $\alpha$ as a function of $n=2^h$.  We conjecture
that the correct bound, for both questions, is $c\in \Theta(\log n)$.
The upper bound $c\in O(\log n)$ for both questions is easily obtained
by divide-and-conquer.

\bibliographystyle{plain}
\bibliography{anagram}

\end{document}


