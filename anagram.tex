\documentclass{patmorin}
\listfiles
\usepackage[utf8]{inputenc}
\usepackage{microtype}
\usepackage{amsthm,amsmath,graphicx}
\usepackage{pat}
\usepackage[letterpaper]{hyperref}
\usepackage[table,dvipsnames]{xcolor}
\definecolor{linkblue}{named}{Blue}
\hypersetup{colorlinks=true, linkcolor=linkblue,  anchorcolor=linkblue,
citecolor=linkblue, filecolor=linkblue, menucolor=linkblue,
urlcolor=linkblue} 
\setlength{\parskip}{1ex}
\usepackage{wasysym}

\title{\MakeUppercase{Anagram-Free Chromatic Number is not Pathwidth-Bounded}%
   \thanks{This work was partly funded by NSERC and the Ontario Ministry of
    Research, Innovation and Science}}

\author{Paz Carmi%
   \thanks{Department of Computer Science,
           Ben-Gurion University of the Negev}\quad%
   Vida Dujmović%
   \thanks{School of Computer Science and Electrical Engineering, 
           University of Ottawa}\quad%
   Pat Morin%
   \thanks{School of Computer Science, Carleton University}}%

%\usepackage[mathlines]{lineno}
%\linenumbers
%\setlength{\linenumbersep}{2.5cm}
%\rightlinenumbers
%\linenumbers
%\newcommand*\patchAmsMathEnvironmentForLineno[1]{%
%  \expandafter\let\csname old#1\expandafter\endcsname\csname #1\endcsname
%  \expandafter\let\csname oldend#1\expandafter\endcsname\csname end#1\endcsname
%  \renewenvironment{#1}%
%     {\linenomath\csname old#1\endcsname}%
%     {\csname oldend#1\endcsname\endlinenomath}}% 
%\newcommand*\patchBothAmsMathEnvironmentsForLineno[1]{%
%  \patchAmsMathEnvironmentForLineno{#1}%
%  \patchAmsMathEnvironmentForLineno{#1*}}%
%\AtBeginDocument{%
%\patchBothAmsMathEnvironmentsForLineno{equation}%
%\patchBothAmsMathEnvironmentsForLineno{align}%
%\patchBothAmsMathEnvironmentsForLineno{flalign}%
%\patchBothAmsMathEnvironmentsForLineno{alignat}%
%\patchBothAmsMathEnvironmentsForLineno{gather}%
%\patchBothAmsMathEnvironmentsForLineno{multline}%
%}


\newcommand{\question}[1]{\textbf{\color{red}Question:}~#1}

\DeclareMathOperator{\pw}{pw}

\newcommand{\eps}{\epsilon}



%\pagenumbering{roman}
\begin{document}
%\begin{titlepage}
\maketitle
%
\begin{abstract}
  The anagram-free chromatic number is a new graph parameter
  introduced independently by Kamčev, Łuczak, and Sudakov
  \cite{kamcev.luczak.ea:anagram-free} and Wilson and Wood
  \cite{wilson.wood:anagram-free}.  In this note, we show that there
  are planar graphs of pathwidth 3 with arbitrarily large anagram-free
  chromatic number.
\end{abstract}
%\end{titlepage}
%
%\tableofcontents
%
%\newpage


\section{Introduction}
\pagenumbering{arabic}

A string $s=s_1,\ldots,s_{2k}$ is called an \emph{anagram} if
$s_1,\ldots,s_k$ is a permutation of $s_{k+1},\ldots,s_{2k}$.
For a graph $G$, a $c$-colouring $\varphi:V(G)\to\{1,\ldots,c\}$ is
\emph{anagram-free} if, for every odd-length path $v_1,v_2,\ldots,v_{2k}$
in $G$, the string $\varphi(v_1),\ldots,\varphi(v_{2k})$ is not an
anagram.  The \emph{anagram-free chromatic number} of $G$, denoted
$\pi_\alpha(G)$, is the smallest value of $c$ for which $G$ has an
anagram-free $c$-colouring.

Answering a long-standing question of Erd\H{o}s and Brown, Ker\"anen
\cite{keranen:abelian} showed that the path $P_n$ on $n$ vertices has an
anagram-free 4-colouring.  A straightforward divide-and-conquer
algorithm applied to any $n$-vertex graph of treewidth $k$ yields
an anagram-free $O(k\log n)$-colouring.  The same divide-and-conquer
algoritm, applied to graphs that exclude a fixed minor gives an anagram
free $O(\sqrt{n})$-colouring \cite{kamcev.luczak.ea:anagram-free}.
An interesting variant of this divide-and-conquer algorithm is used by
Wilson and Wood \cite{wilson.wood:anagram-free} to obtain anagram-free
$(4k+1)$-colourings of trees of pathwidth $k$.  On the negative side,
Kamčev, Łuczak, and Sudakov \cite{kamcev.luczak.ea:anagram-free} and
Wilson and Wood \cite{wilson.wood:anagram-free} have shown that there
are trees---even binary trees---with arbitrarily large anagram-free
chromatic number.  These results, and some others, are summarized in
\tabref{results}.

\begin{table}
  \begin{center}
    \begin{tabular}{lll}
      \textbf{Graph class} & \textbf{Bounds} & \textbf{Reference} \\ \hline
       Paths & $\pi_\alpha(G)= 4$ & \cite[Theorem~1]{keranen:abelian}  \\
       Graphs of treewidth $k$ & $\pi_\alpha(G)\in O(k\log n)$ & folklore  \\
       Graphs excluding a minor of size $h$ & $\pi_\alpha(G)\in O(h^{3/2}n^{1/2})$ 
              & \cite[Proposition~1.2]{kamcev.luczak.ea:anagram-free} \\
       Trees & $\pi_\alpha(G)\in\Omega(\log n/\log\log n)$ 
              & \cite[Theorem~3]{wilson.wood:anagram-free} \\
       Trees of pathwidth $k$ & $k\le \pi_\alpha(G)\le 4k+1$ 
              & \cite[Theorem~5]{wilson.wood:anagram-free} \\
       Trees of radius $r$ & $r\le \pi_\alpha(G)\le r+1$ 
              & \cite[Theorem~4]{wilson.wood:anagram-free} \\
       Binary trees & $\pi_\alpha(G)\in\Omega(\sqrt{\log n/\log\log n})$ 
              & \cite[Proposition~1.1]{kamcev.luczak.ea:anagram-free} \\ 
       $4$-regular graphs & $\pi_\alpha(G)\in \Omega(\sqrt{n}/\log n)$ 
           & \cite[Proposition~3.1]{kamcev.luczak.ea:anagram-free} \\
       $d$-regular graphs & $\pi_\alpha(G)\in \Omega(n)$ & \cite[Theorem~1.3]{kamcev.luczak.ea:anagram-free} \\
       Subdivisions of graphs & $\pi_\alpha(G) \le 8$ 
         & \cite[Theorem~6]{wilson.wood:anagram-free2} \\
       Planar graphs & $\pi_\alpha(G)\in O(\sqrt{n})$ &
              \cite[Corollary~2.3]{kamcev.luczak.ea:anagram-free} \\
       Planar graphs of maximum degree 3 & $\pi_\alpha(G)\in\Omega(\log n)$ 
         & \cite[Proposition~2.4]{kamcev.luczak.ea:anagram-free} \\
           & & \cite[Theorem~1]{wilson.wood:anagram-free} \\
       Planar graphs of pathwidth 3 & $\pi_\alpha(G) \in \Omega(\log n)$
         & \thmref{main} 
    \end{tabular}
  \end{center}
  \caption{Bounds on anagram-free chromatic number.  Upper bounds apply
  to all graphs in the class. Lower bounds apply to some graphs in
  the class.}
  \tablabel{results}
\end{table}

All of the examples of graphs having large anagram-free chromatic
number are graphs with large pathwidth \cite{robertson.seymour:graph}.  Therefore, an obvious question
is whether anagram-free chromatic number is pathwidth-bounded, i.e.,
can $\pi_\alpha(G)$ be upper bounded by some function of the pathwidth
$\pw(G)$ of $G$?  Such a result seems plausible, for two reasons:
\begin{enumerate}
\item pathwidth is a measure of how path-like a graph
is and Ker\"anen showed that paths have anagram-free 4-colourings; and
\item the result of Wilson and Wood \cite{wilson.wood:anagram-free} shows that $\pi_\alpha(T)\le 4\pw(T)+1$
for every tree, $T$. 
\end{enumerate}
The purpose of this note, however, is to show that the result of Wilson
and Wood can not be strengthened even to planar graphs of pathwidth 3
and maximum degree 5.

\begin{thm}\thmlabel{main}
  For every $n\in N$, there exists a $2n$-vertex planar graph of
  pathwidth 3 and maximum degree 5 whose anagram-free chromatic number
  is at least $\log_2(n+1)$.
\end{thm}

\section{Proof of \thmref{main}}

Let $s\in\Sigma^*$ be a string over some alphabet $\Sigma$.  For each
$a\in\Sigma$, we let $n_a(s)$ denote the number of occurences of $a$
in $s$.  We say that $s$ is \emph{even} if $n_a(s)$ is even for each
$a\in\Sigma$.  The following lemma says that strings with no even
substrings must use an alphabet of at least logarithmic size.

\begin{lem}\lemlabel{parity}
  If $s=s_0,\ldots,s_{2n-1}\in\Sigma^{2n}$ and $|\Sigma|< \log_2(n+1)$,
  then $s$ contains a non-empty even substring $s_{2i},\ldots,s_{2j-1}$
  for some $0\le i < j\le n$.
\end{lem}

\begin{proof}
  For any string $q\in\Sigma^*$, we define the \emph{parity vector}
  $P(q)=\langle n_a(q)\bmod 2: a\in\Sigma \rangle$ and observe that $q$ is
  even if and only if $P(q)=\langle 0,\ldots,0\rangle$.   Furthermore, for
  two strings $p$ and $q$, the parity vector of their concatenation $pq$
  is equal to the xor-sum (i.e., modulo 2 sum) of their parity vectors:
  \[
     P(pq) = P(p)\oplus P(q) \enspace .
  \] 
  Define the strings $t_0,\ldots,t_n$, where $t_0$ is the empty string
  and, for each $i\in\{1,\ldots,n\}$, define $t_i=s_0,\ldots,s_{2i-1}$.

  Now consider the parity vectors $P(t_0),P(t_1),\ldots,P(t_n)$.
  Each of these $n+1$ vectors is a binary string of length
  $|\Sigma| < \log_2(n+1)$ therefore, there must exist two indices
  $i,j\in\{0,\ldots,n\}$ with $i<j$ such that $P(t_i)=P(t_j)$.  However,
  \[
      P(t_j) = P(t_i) \oplus P(s_{2i},\ldots,s_{2j-1}) 
  \]
  and since $P(t_i)=P(t_j)$, this implies that $P(s_{2i},\ldots,s_{2j-1})=\langle0,\ldots,0\rangle$
  and $s_{2i},\ldots,s_{2j-1}$ is even, as required.
\end{proof}


The next lemma says that if we split an even string into consecutive
pairs, then we can can colour one element of each pair red and the other
blue in such a way that the resulting red and blue multisets are exactly
the same.
\begin{lem}\lemlabel{splitting}
  Let $s=s_0,\ldots,s_{2r-1}\in\Sigma^{2r}$ be an even string. Then there
  exists a binary sequence $v_0,\ldots,v_{r-1}$ such that the string
  $s_v=s_{0+v_0},s_{2+v_1},\ldots,s_{2(r-1)+v_{r-1}}$ 
  has $n_a(s_v)=n_a(s)/2$
  for all $a\in\Sigma$.
\end{lem}

\begin{proof}
  Suppose for the sake of contradiction that the lemma is not true, and
  let $s$ be the shortest counterexample.  For $v\in\{0,1\}^{r}$, let
  $s_{\overline{v}}=s_{0+1-v_0},s_{2+1-v_1},\ldots,s_{2(r-1)+1-v_{r-1}}$
  be the complement of $s_v$.  Let $v\in\{0,1\}^{r}$ be the binary vector
  that minimizes
  \begin{equation}\eqlabel{minimizer}
     \sum_{a\in\Sigma}|n_a(s_v)-n_a(s_{\overline{v}})| \enspace .
  \end{equation}
  Since $s$ is a counterexample to the lemma, \eqref{minimizer} is
  greater than zero.

  For each $j\in\{0,\ldots,r-1\}$, let $x_{j}=s_{2j+v_j}$ and
  let $y_j=s_{2j+1-v_j}$ so that $s_v=x_0,\ldots,x_{r-1}$ and
  $s_{\overline{v}}=y_0,\ldots,y_{r-1}$.  Since \eqref{minimizer}
  is non-zero, there exists some $j_1$ such that $n_{x_{j_1}}(s_v) >
  n_{x_{j_1}}(s_{\overline{v}})$.  This means that $n_{y_{j_1}}(s_v) \ge
  n_{y_{j_1}}(s_{\overline{v}})$, otherwise flipping\footnote{Here and
  throughout, flipping a binary variable $b$ means changing its value to $1-b$.}
  $v_{j_1}$ would decrease \eqref{minimizer} by two.  Furthermore,
  $y_{j_1}\neq x_{j_1}$ since, otherwise, we could remove $s_{2j}$
  and $s_{2j+1}$ from $s$ and obtain a smaller counterexample, since
  the value of $v_j$ has no effect on \eqref{minimizer}.

  Refer to \figref{swapping}.
  Let $a_1=x_{j_1}$ and for $k=2,3,4\ldots$, define $a_k = y_{j_{k-1}}$
  and define $j_k$ to be any index such that $x_{j_k}=a_k$.  Notice that
  that $n_{a_k}(s_v)\ge n_{a_{k}}(s_{\overline{v}})$ since, otherwise,
  flipping $v_{j_1},\ldots,v_{j_{k-1}}$ would decrease the value of
  \eqref{minimizer}.  Indeed, flipping $v_{j_1},\ldots,v_{j_{k-1}}$
  decreases $n_{a_1}(s_v)$ by one, increases $n_{a_k}(s_v)$ by one, and
  does not change $n_a(s_v)$ for any $a\in\Sigma \setminus \{a_1,a_k\}$.
  This implies that $j_{k}$ is well-defined since
  $n_{a_k}(s_v)\ge n_{a_k}(s_{\overline{v}})\ge 1$.

  \begin{figure}
    \begin{center}
       \includegraphics{figs/swapping}
    \end{center}
    \caption{The proof of \lemref{splitting}.}
    \figlabel{swapping}
  \end{figure}

  Since $s$ is finite, there is some minimum value $k$ such that
  $a_{k}=a_{k'}$ for some $k' < k$.  This defines a sequence of indices
  $j_{k'},\ldots,j_{k-1}$ such that
  \begin{enumerate}
     \item $a_{k'}=x_{j_{k'}}=y_{j_{k-1}}=a_{k}$; 
     %\item $n_{a_\ell}(s_v)\ge n_{a_\ell}(s_{\overline{v}})$ for all $\ell\in\{k',\ldots,k\}$; and
     \item $a_{\ell}=y_{j_{\ell-1}}=x_{j_\ell}$ for all $\ell\in\{k'+1,\ldots,k-1\}$.
  \end{enumerate}
  In words, for each $\ell\in\{k',\ldots,k\}$, each occurrence of $a_\ell$ in $s_v$ is matched with a corresponding
  occurrence of $a_\ell$ in $s_{\overline{v}}$.
  We claim that this contradicts
  the minimality of $s$. Indeed, by removing
  $s_{2_{j_{k'}}},s_{2j_{k'}+1},s_{2j_{k'+1}},s_{2j_{k'+1}+1},\ldots,s_{2j_{k-1}},s_{2j_{k-1}+1}$
  from $s$ we obtain a smaller counterexample.
\end{proof}

\begin{proof}[Proof of \thmref{main}]
Let $G$ be the graph with vertex set
$V(G)=\{x_1,\ldots,x_{n},y_1,\ldots,y_{n}\}$ and with edge set
\[
  E(G) = \{x_iy_i : i\in\{0,\ldots,n-1\}\} \cup \bigcup_{i=0}^{n-2} \{x_iy_{i+1},x_{i+1}y_i\} \enspace .
\]
The graph $G$ has pathwidth 3 as can be seen from the path decomposition $B_0,\ldots,B_{n-2}$ where $B_i=\{v_i,w_i,v_{i+1},w_{i+1}\}$.
See \figref{graph}. Although not immediately obvious from \figref{graph}, $G$ is also planar---see \figref{planar}.

\begin{figure}
  \begin{center}
    \includegraphics{figs/g}
  \end{center}
  \caption{The graph $G$ in the proof of \thmref{main}.}
  \figlabel{graph}
\end{figure}

\begin{figure}
  \begin{center}
    \includegraphics[width=\textwidth]{figs/planar}
  \end{center}
  \caption{The graph $G$ in the proof of \thmref{main} is planar
   and is even a 2-page graph.}
  \figlabel{planar}
\end{figure}


Now, consider some colouring $\varphi:V(G)\to\Sigma$
with $|\Sigma| < \log_2(n+1)$.  Applying \lemref{parity} to
the string 
$s=\varphi(x_1),\varphi(y_1),\ldots,\varphi(x_n),\varphi(y_n)$ we
conclude that there is some $i < j$ such that 
$\varphi(x_{i}),\varphi(y_i),\ldots,\varphi(x_j),\varphi(y_j)$
is even.  By \lemref{splitting} and the
symmetry between each $x_i$ and $y_i$ we can assume that
$n_a(\varphi_(x_i),\ldots,\varphi(x_j))=n_a(\varphi(y_i),\ldots,\varphi(y_j))$
for each $a\in\Sigma$.  But then the path
$x_i,\ldots,x_j,y_j,y_{j-1},\ldots,y_i$ has a colour sequence
$\varphi(x_i),\ldots,\varphi(x_j),\varphi(y_j),\varphi(y_{j-1}),\ldots,\varphi(y_i)$
that is an anagram.
\end{proof}

\section{Generalization to Pathwidth $k$}

\begin{lem}
   Let $X_1,\ldots,X_n\subseteq\Sigma$ be a sequence of sets, each
   of size $k>2$, with $|\Sigma|< \alpha k\log_2 n$. Then there exists indices
   $1\le i< j\le n$ and subsets $X_i',\ldots,X_j'$ such that, for each
   $k\in\{i,\ldots,j\}$,  $X_k'\subseteq X_k$ and $|X_k'|\ge 2$ and,
   for each $a\in\Sigma$ the number of subsets in $X_i',\ldots,X_j'$
   that contain $a$ is even.
\end{lem}

\begin{proof}
   The proof is by induction on $n$.  The cases $n=1$ $n=2$ are vacuous, 
   since we must have $|\Sigma|\ge k$ but also $|\Sigma|< \alpha k\log n$.

   For a set $I\subset\Sigma$, let $N(I)=\{i\in\{1,\ldots,n\}: X_i\cap
   I\neq\emptyset\}$.  Suppose that there exists some $I\subset\Sigma$ 
   such that $|N(I)| < |I|/(k-2)$.  Then the elements of $N(I)$ partition
   $\{1,\ldots,n\}$ into at most $|N(I)|+1$ intervals, one of which must
   contain at least
   \[
       r = \frac{n-|N(I)|}{|N(I)|+1}
       \ge \frac{n-|N(I)|}{2|N(I)|}
        > \frac{(n-N(I))(k-2)}{2|I|}
        > \frac{(n-|I|/(k-2))(k-2)}{2|I|}
   \]
   elements. Thus, there is sequence $X_1',\ldots,X_r'=X_{i'+1},\ldots,x_{i'+r}$  such that $|\bigcup_{i=1}^r X_i'| \le |\Sigma|-|I|$.
   Therefore, we can apply induction on $X_1'\ldots,X_r'$ on the alphabet $\Sigma'=\Sigma\setminus I$ provided that
   \[
         |\Sigma'| < \alpha k\log r \enspace .
   \]
   This is indeed true, since
   \begin{align*}
      \alpha k\log r & > \alpha k\log\left(\frac{(n-|I|/(k-2))(k-2)}{2|I|}\right) \\
             & = \alpha k\log(n-|I|/(k-2)) + \alpha k\log\left(\frac{k-2}{2|I|}\right) \\
             & = \alpha k\log n  + \alpha k\log\left(\frac{k-2}{2|I|}\right) - O_n\left(\frac{|I|}{n}\right) \\
             & > |\Sigma| \alpha k\log n  + \alpha k\log\left(\frac{k-2}{2|I|}\right) - O_n\left(\frac{|I|}{n}\right) \\
   \end{align*}
   

   Define a bipartite graph $H$ with vertex set
   $V(H)=\Sigma\cup\{1,\ldots,n\}$ and edge set 
   $E(H)=\{(a,i): i\in\{1,\ldots,n\}, a\in\Sigma\cap X_i\}$.  We will show that $E(H)$
   contains a subset $E'$ such that each element $a\in\Sigma$ appears
   exactly once in $E'$ and each element of $\{1,\ldots,n\}$ appears at
   most $k-2$ times in $E'$.  Note that this is sufficient, since we can
   

  
   
   Su suppose there exists a
   subset $I\subset\Sigma$, $|\bigcup_{i\in I} X_i| > (k-2)|I|$.
   




   Then use augmenting path argument.
\end{proof}


\begin{thm}
  For every integer $n$ and and every integer $k>2$, there exists a
  $kn$-vertex graph $G$ of pathwidth $2k-1$ with $\pi_\alpha(G)\ge
  k\log_2 n$.
\end{thm}

\begin{proof}


\end{proof}

\section{Remarks}

We have show that anagram-free chromatic number is not pathwidth-bounded,
even for planar graphs.  The graph we use in the proof of \thmref{main}
is a 2-page graph; it has a book embedding using two pages.  Outerplanar
graphs have a book embedding using a single page.  Is anagram-free
chromatic number pathwidth-bounded for outerplanar graphs?


\bibliographystyle{plainurl}
\bibliography{anagram}

\end{document}


